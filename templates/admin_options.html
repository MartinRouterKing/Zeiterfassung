{% extends 'base.html' %}

{% block content %}
{% load bootstrap3 %}       {# import bootstrap3 #}
{% bootstrap_css %}         {# Embed Bootstrap CSS #}
{% bootstrap_javascript jquery='full' %}  {# Embed Bootstrap JS+jQuery #}
{{ form.media }}            {# Adds date-picker required JS and CSS #}


<head>
    <style>

    a{
        display: block;
    }

    table{
        overflow: auto;
    }

    .glyphicon-arrow-right{
        color: #337ab7;
        margin-top: 10px;
    }

    .glyphicon-arrow-left{
        color: #337ab7;
        margin-top: 5px;
    }

    .glyphicon-plus{
        color: #79c338;
    }

    .glyphicon-pencil{
        color: #efb80b;
    }

    .glyphicon-remove{
        color: red;
    }

    a.glyp_container{
        margin-top: 50%;
    }

    div.col{
        margin: 10px;
    }

    .test{
        background-color: rgba(2,8,24,0.8);
        margin: 10px;
        padding: 20px;
    }

    table{
    table-layout: fixed;
    width: 100%;
    }

    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

    <div class="test">

    <strong style="color:white;">Gruppierung der Elemente in Kategorien</strong>
    <div class="row">
        <div class="col">
            <select class="form-control" id="id_categorie">
                <option selected> ---- </option>
                {% for k in kat %}
                <option> {{k}} </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-" >
            <a class="glyp_container"><span onclick="return popitup('/options/admin_options/addcategories/')" style="font-size: 110%; margin: 5px" class="glyphicon glyphicon-plus"></span></a>
        </div>
        <div class="col-">
            <a class="glyp_container"><span onclick="return popitup('/options/admin_options/editcategories/')" style="font-size: 110%; margin: 5px" class="glyphicon glyphicon-pencil"></span></a>
        </div>
        <div class="col-">
            <a class="glyp_container"><span onclick="return popitup('/options/admin_options/deletecategories/')" style="font-size: 110%; margin: 5px;" class="glyphicon glyphicon-remove"></span></a>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <select multiple class="form-control" id="id_element">

            </select>
            <div id="alert_div">
                    </div>

        </div>
        <center>
            <div class="col-">
                <a><span onclick= "add()" style="font-size: 150%;" class="glyphicon glyphicon-arrow-right"></span></a>
                <a><span onclick="remove()" style="font-size: 150%;" class="glyphicon glyphicon-arrow-left"></span></a>
            </div>
        </center>
                <div class="col">
                    <select multiple class="form-control" id="favorite">

                    </select>
                    <button class="btn btn-primary" style="margin: 10px;" onclick="savefavelem()">Speichern</button>

                </div>
    </div>
    </div>

<script>
       function popitup(url) {
    newwindow=window.open(url,'{{title}}','height=500,width=500');
    if (window.focus) {newwindow.focus()}
    return false};



        function savefavelem(){
        var cat = document.getElementById("id_categorie");
        var cat = cat.options[cat.selectedIndex].text;

        var fav = document.getElementById("favorite");
        txt = [];
            for (i = 0; i < fav.length; i++) {
            txt = txt + "," + fav.options[i].value;
        console.log(txt);
        };

        $.ajax({
            type: "POST",
            url: 'load_categorie/',
            data: {
            'favorites': txt,
            'categorie': cat,
            csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(data){
            $('#alert_div').html('<div id="alert" style="margin: 10px; margin-left: 0px; height: 10%" class="alert alert-success"><strong>Gruppierung gespeichert</strong></div>');

            $('#alert').fadeOut(10000);


            }
        });

        $.ajax({
            type: 'POST',
            url: 'ajax_table/',
            data:{
            csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function(data){
                $('#table_div').html(data);
                }
      });
        }
</script>

<script>
    $("#id_categorie").change(function () {
        var cat = document.getElementById("id_categorie");
        var text = cat.options[cat.selectedIndex].text;
        console.log(text);

        $.ajax({
            type: "POST",
            url: 'load_elements/',
            data: {
            'categorie': text,
            csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (data) {

                $('#id_element').html(data);
                }
    });

            $.ajax({
            type: "POST",
            url: 'load_fav/',
            data: {
            'categorie': text,
            csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (data) {
                $('#favorite').html(data);
                }
    });
    });

    function add(){

    var cat = document.getElementById("id_element");
    var text = cat.options[cat.selectedIndex].text;
    var selectedID = cat.selectedIndex
    console.log(selectedID)
    cat.remove(cat.selectedIndex);


    var x = document.getElementById("favorite");
    var option = document.createElement("option");
    option.text = text;
    x.add(option);

    $('#id_element').prop("selectedIndex",selectedID);

    }

    function remove(){
    console.log("remove");
    var fav = document.getElementById("favorite");
    var text = fav.options[fav.selectedIndex].text;
    var selectedID = fav.selectedIndex;
    fav.remove(fav.selectedIndex);

    var x = document.getElementById("id_element");
    var option = document.createElement("option");
    option.text = text;
    x.add(option);

    $('#favorite').prop("selectedIndex",selectedID);

    }
</script>
<script>

$(document).ready(function () {
      $.ajax({
        type: 'POST',
        url: 'ajax_table/',
        data:{
        csrfmiddlewaretoken: "{{ csrf_token }}"
        },
        success: function(data){
            $('#table_div').html(data);
            }
      });
});
</script>


<div class="test" id="table_div">
<i class="fa fa-spinner fa-spin" style="font-size:24px; color:#65add6"></i>
</div>

<script>

    $('document').ready(function(){

    var table = document.getElementById('table');

    for (var r = 1, n = table.rows.length; r < n; r++) {

        for (var c = 3, m = table.rows[r].cells.length; c < m; c++) {

            var element =  table.rows[r].cells[0].innerHTML;
            var wie = table.rows[r].cells[1].children[0].children[0].children[0].value;
            var obj = table.rows[r].cells[2].children[0].children[0].children[0].value;
            var categorie = table.rows[r].cells[0].closest('tbody').id;
            var type = table.rows[0].cells[c].innerHTML;
            var chkbox = table.rows[r].cells[c].children[0].children[0].children[0];
            var calc = table.rows[r].cells[c].children[1];
            var calc_data = calc.options[calc.selectedIndex].value;

        }
    }
    });

</script>


<script>
    function Collapse(object) {
        console.log(object.id);
        var obj = object.id;

        if (obj == 'show'){
        $(object).closest('tbody').next('tbody').hide("fast");
        $(object).prop('id', 'hide');
        } else {
        $(object).closest('tbody').next('tbody').show("fast");
        $(object).prop('id', 'show');
        }
    }

</script>


<script>

function save() {
    var table = document.getElementById('table');

    var table_data = [];
    var type_arr = [];
    var categorie_arr = [];
    var element_arr = [];
    var checked_arr = [];


    for (var r = 1, n = table.rows.length; r < n; r++) {

        for (var c = 3, m = table.rows[r].cells.length; c < m; c++) {
            var colum = [];

            var element =  table.rows[r].cells[0].innerHTML;
            colum.push(element);

            var wie = table.rows[r].cells[1].children[0].children[0].children[0].value
            colum.push(wie);

            var obj = table.rows[r].cells[2].children[0].children[0].children[0].value;
            colum.push(obj);

            var categorie = table.rows[r].cells[0].closest('tbody').id;
            colum.push(categorie);

            var type = table.rows[0].cells[c].innerHTML;
            colum.push(type);

            var chkbox = table.rows[r].cells[c].children[0].children[0].children[0];
            colum.push(chkbox.checked);

            var calc = table.rows[r].cells[c].children[1];
            var calc_data = calc.options[calc.selectedIndex].value;
            colum.push(calc_data);

            table_data.push(colum);
            console.log(table_data);
       }

    }

      $.ajax({
        type: 'POST',
        url: 'load_combination/',
        data:{
        data: table_data,
        csrfmiddlewaretoken: "{{ csrf_token }}"
        },
        success: function(data){
            $('#alert_table').html('<div id="alert" style="margin: 10px; margin-left: 0px; height: 10%" class="alert alert-success"><strong>Gruppierung gespeichert</strong></div>');
            $('#alert_table').fadeOut(10000);
            }
      });
}

</script>
<div style="background-color: gray">
<table>

  {% for r in a %}
    {% cycle '<tr>' '</tr>'%}
    {% for i in r %}
        <td>{{i}}</td>
    {% endfor %}
  {% endfor %}
</table>
    </div>


{% endblock %}
